/*! tinyplot 2015-06-15 */
(function(){var a,b,c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};this.NumberFormatter=function(){function a(){}return a.prototype.format=function(a,b){return b.toString()},a}(),this.DollarFormatter=function(){function a(){}return a.prototype.format=function(a,b){var c;return c=b.toFixed(2),c.endsWith("00")?b.toString():c},a}(),this.TimeFormatter=function(){function a(){}return a.prototype.format=function(a,b){var c,d;return d=moment(b),c=1e4>a?"mm:ss.SS":36e5>a?"hh:mm:ss":2592e6>a?"MM/DD|hh:mm A":"YYYY-MM-DD",d.format(c)},a}(),d=6e4,c=60*d,b=24*c,a=function(){function a(a,b){this.dirty=!0,this.step=1,this.clampMax=null,this.clampMin=null,this.tickSize=8,this.fontSize=12,this.color="#444",this.gridColor="#ccc",this.maxTicks=10,this.label=null,this.roundingStrategy="base10",this.resize(a,b)}return a.prototype.toString=function(){return""+this.min+" to "+this.max+", step = "+this.step+" (clamp at "+this.clampMin+" to "+this.clampMax+")"},a.prototype.makeDirty=function(){return this.dirty=!0},a.prototype.resize=function(a,e){var f,g;switch(this.min=a,this.max=e,this.span=e-a,this.roundingStrategy){case"base10":f=Math.floor(Math.log10(this.span)-1),this.step=Math.pow(10,f);break;case"time":this.step=this.span<1e3?100:this.span<d?1e3:this.span<c?d:this.span<3*b?c:b;break;default:throw"Invalid roundingStrategy: "+this.roundingStrategy}for(g=[];this.span/this.step>this.maxTicks;)g.push(this.step*=2);return g},a.prototype.zoom=function(a){var b,c,d,e;return b=(this.max+this.min)/2,e=this.span/a,this.clampMin&&this.clampMax&&e>this.clampMax-this.clampMin?(this.min=this.clampMin,this.max=this.clampMax,this.span=this.clampMax-this.clampMin):(d=b-e/2,c=b+e/2,this.resize(d,c)),this.dirty=!0},a.prototype.pan=function(a){return 0>a?(!this.clampMax||this.clampMax>this.max)&&(this.max=Math.min(this.clampMax,this.max-a),this.min=this.max-this.span):(!this.clampMin||this.clampMin<this.min)&&(this.min=Math.max(this.clampMin,this.min-a),this.max=this.min+this.span),this.dirty=!0},a.prototype.round=function(){return this.resize(Math.floor(this.min/this.step)*this.step,Math.ceil(this.max/this.step)*this.step)},a.prototype.clamp=function(){return this.clampMin=this.min,this.clampMax=this.max},a.prototype.render=function(a,b,c,d){return a.clearRect(0,0,c,d),this.dirty=!1},a.prototype.renderGrid=function(){return{}},a}(),this.XAxis=function(a){function b(a,c,d){b.__super__.constructor.call(this,a,c,d),this.labels=null}return f(b,a),b.prototype.setFixedArray=function(a){return this.labels=a,this.min=-.5,this.max=this.labels.length-.5,this.step=1,this.span=this.labels.length},b.prototype.render=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o;for(b.__super__.render.call(this,a,c,d,e),i=d/this.span,k=Math.floor(this.min/this.step)*this.step,a.strokeStyle=this.color,a.beginPath();k<=this.max;)l=Math.ceil((k-this.min)*i)-.5,a.moveTo(l,0),a.lineTo(l,this.tickSize),k+=this.step;for(a.stroke(),k=Math.floor(this.min/this.step)*this.step,a.font=""+this.fontSize+"px sans-serif",a.textAlign="center",a.fillStyle=this.color,f=-1;k<=this.max;){for(l=Math.ceil((k-this.min)*i)-.5,j=this.labels?f>-1?this.labels[f]:"":c.format(this.span,k),h=j.split("|"),m=this.tickSize+this.fontSize,f+=1,n=0,o=h.length;o>n;n++)g=h[n],a.fillText(g,l,m),m+=this.fontSize;k+=this.step}return a.fillText(this.label,d/2,this.tickSize+3*this.fontSize+2)},b.prototype.renderGrid=function(a,b,c){var d,e,f;for(d=b/this.span,e=Math.floor(this.min/this.step)*this.step,a.strokeStyle=this.gridColor,a.beginPath();e<=this.max;)f=Math.ceil((e-this.min)*d)-.5,a.moveTo(f,0),a.lineTo(f,c),e+=this.step;return a.stroke()},b}(a),this.YAxis=function(a){function b(a,c,d){b.__super__.constructor.call(this,a,c,d)}return f(b,a),b.prototype.render=function(a,c,d,e){var f,g,h,i,j,k,l,m;for(b.__super__.render.call(this,a,c,d,e),h=e/this.span,j=Math.floor(this.min/this.step)*this.step,a.strokeStyle=this.color,a.beginPath();j<=this.max;)k=Math.ceil(e-(j-this.min)*h)-.5,0>k&&(k=.5),a.moveTo(d-this.tickSize,k),a.lineTo(d,k),j+=this.step;for(a.stroke(),j=Math.floor(this.min/this.step)*this.step,a.font=""+this.fontSize+"px sans-serif",a.textAlign="right",a.fillStyle=this.color;j<=this.max;){for(k=Math.ceil(e-(j-this.min)*h)-.5,a.textBaseline=0>=k?"top":k>=e-1?"alphabetic":"middle",i=c.format(this.span,j),g=i.split("|"),l=0,m=g.length;m>l;l++)f=g[l],a.fillText(f,d-this.tickSize-3,k),k+=this.fontSize;j+=this.step}return a.textAlign="center",a.translate(this.fontSize,e/2),a.rotate(3*Math.PI/2),a.fillText(this.label,0,0)},b.prototype.renderGrid=function(a,b,c){var d,e,f;for(d=c/this.span,e=Math.floor(this.min/this.step)*this.step,a.strokeStyle=this.gridColor,a.beginPath();e<=this.max;)f=Math.ceil(c-(e-this.min)*d)-.5,a.moveTo(0,f),a.lineTo(b,f),e+=this.step;return a.stroke()},b}(a)}).call(this),function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}};window.tinyplot={},a=function(){function a(a,b,d,e,f){this.canvas=a,this.width=b,this.height=d,this.xRange=e,this.yRange=f,this.lineTo=c(this.lineTo,this),this.moveTo=c(this.moveTo,this)}return a.prototype.clear=function(){return this.canvas.clearRect(0,0,this.width,this.height)},a.prototype.setStroke=function(a,b){return this.canvas.strokeStyle=a,this.canvas.lineWidth=b},a.prototype.stroke=function(a){return this.canvas.beginPath(),a(),this.canvas.stroke()},a.prototype.plotToCanvas=function(a){return a.x=(a.x-this.xRange.min)/this.xRange.span*this.width,a.y=(1-(a.y-this.yRange.min)/this.yRange.span)*this.height},a.prototype.canvasToPlot=function(a){return a.x=a.x*this.xRange.span/this.width+this.xRange.min,a.y=(1-a.y/this.height)*this.yRange.span+this.yRange.min},a.prototype.moveTo=function(a){return this.plotToCanvas(a),this.canvas.moveTo(a.x,a.y)},a.prototype.lineTo=function(a){return this.plotToCanvas(a),this.canvas.lineTo(a.x,a.y)},a.prototype.drawMarkers=function(a,b,c,d,e){var f,g,h,i,j;for(this.canvas.fillStyle=c,j=[],f=h=0,i=d.length;i>=0?i>=h:h>=i;f=i>=0?++h:--h)switch(g={x:d[f],y:e[f]},this.plotToCanvas(g),a){case"circle":this.canvas.beginPath(),this.canvas.arc(g.x,g.y,b/2,0,2*Math.PI,!1),j.push(this.canvas.fill());break;case"triangle":this.canvas.beginPath(),this.canvas.moveTo(g.x,g.y-b/2),this.canvas.lineTo(g.x-b/2,g.y+b/2),this.canvas.lineTo(g.x+b/2,g.y+b/2),j.push(this.canvas.fill());break;case"square":this.canvas.beginPath(),this.canvas.moveTo(g.x-b/2,g.y-b/2),this.canvas.lineTo(g.x-b/2,g.y+b/2),this.canvas.lineTo(g.x+b/2,g.y+b/2),this.canvas.lineTo(g.x+b/2,g.y-b/2),j.push(this.canvas.fill());break;default:throw"Unknown marker: "+a}return j},a}(),b=function(a){var b;return b=a.find("canvas")[0],b.width=a.width(),b.height=a.height(),b.getContext("2d")},this.Chart=function(){function c(a,c){var d,e=this;this.container=$(a),this.container.addClass("tinyplot-chart"),this.opts=c,_.defaults(c,{title:"Chart Title",subtitle:"",xZoom:"none",yZoom:"none",xLabel:"x",yLabel:"y",xMaxTicks:10,yMaxTicks:10,grid:null,useDataCanvas:!0,interact:!0}),this.xZoomType=c.xZoom,this.yZoomType=c.yZoom,this.xFormatter=new NumberFormatter,this.yFormatter=new NumberFormatter,this.titleArea=$('<div class="title-area"></div>').appendTo(this.container),$("<div class='title text'>"+c.title+"</div>").appendTo(this.titleArea),$("<div class='subtitle text'>"+c.subtitle+"</div>").appendTo(this.titleArea),this.xAxisCanvasContainer=$('<div class="x-axis"><canvas/></div>').appendTo(this.container),this.xAxisCanvas=b(this.xAxisCanvasContainer),this.xAxis=new XAxis(0,1),this.xAxis.label=this.opts.xLabel,this.xAxis.maxTicks=this.opts.xMaxTicks,this.yAxisCanvasContainer=$('<div class="y-axis"><canvas/></div>').appendTo(this.container),this.yAxisCanvas=b(this.yAxisCanvasContainer),this.yAxis=new YAxis(0,1),this.yAxis.label=this.opts.yLabel,this.yAxis.maxTicks=this.opts.yMaxTicks,this.dataCanvasContainer=$('<div class="data"></div>').appendTo(this.container),this.opts.useDataCanvas?(this.dataCanvasContainer.append("<canvas/>"),this.dataCanvas=b(this.dataCanvasContainer),this.makeContext()):(this.dataCanvas=null,this.dataCanvasContainer.addClass("no-canvas"),this.context=null),this.opts.interact&&(this.dataIntercept=$('<div class="data-intercept"></div>').appendTo(this.container),d=!1,this.dataIntercept.mousedown(function(){return d=!0}),this.dataIntercept.click(function(a){return d?(e.onClick({x:a.offsetX,y:a.offsetY}),d=!1):void 0}),interact(this.dataIntercept[0]).draggable({inertia:!0,onstart:function(){return d=!1},onmove:function(a){return e.pan(a.dx,a.dy)}}).gesturable({onmove:function(a){return e.zoom(1+a.ds)}}),this.container.on("mousewheel",function(a){return e.zoom(1+a.deltaY/1e3),a.preventDefault()}))}return c.prototype.xResize=function(a,b){return this.xAxis.resize(a,b),console.log("xAxis: "+this.xAxis.toString()),this.xAxis.makeDirty()},c.prototype.xRound=function(){return this.xAxis.round(),console.log("xAxis: "+this.xAxis.toString())},c.prototype.xClamp=function(){return this.xAxis.clamp()},c.prototype.yResize=function(a,b){return this.yAxis.resize(a,b),console.log("yAxis: "+this.yAxis.toString()),this.yAxis.makeDirty()},c.prototype.yRound=function(){return this.yAxis.round(),console.log("yAxis: "+this.yAxis.toString())},c.prototype.yClamp=function(){return this.yAxis.clamp()},c.prototype.makeContext=function(){return this.context=new a(this.dataCanvas,this.dataCanvasContainer.width(),this.dataCanvasContainer.height(),this.xAxis,this.yAxis)},c.prototype.zoom=function(a){var b;return b=!1,"user"===this.xZoomType&&(this.xAxis.zoom(a),b=!0),"user"===this.yZoomType&&(this.yAxis.zoom(a),b=!0),b?this.render():void 0},c.prototype.pan=function(a,b){var c;return c=!1,"user"===this.xZoomType&&(this.xAxis.pan(a/this.context.width*this.xAxis.span),c=!0),"user"===this.yZoomType&&(this.yAxis.pan(b/this.context.height*this.yAxis.span),c=!0),c?this.render():void 0},c.prototype.onClick=function(){return{}},c.prototype.renderData=function(){return{}},c.prototype.render=function(){var a,b;return a=(new Date).getTime(),this.xAxis.dirty&&this.xAxis.render(this.xAxisCanvas,this.xFormatter,this.xAxisCanvasContainer.width(),this.xAxisCanvasContainer.height()),this.yAxis.dirty&&this.yAxis.render(this.yAxisCanvas,this.yFormatter,this.yAxisCanvasContainer.width(),this.yAxisCanvasContainer.height()),this.context&&(this.context.clear(),this.opts.grid&&this.opts.grid.indexOf("x")>=0&&this.xAxis.renderGrid(this.dataCanvas,this.context.width,this.context.height),this.opts.grid&&this.opts.grid.indexOf("y")>=0&&this.yAxis.renderGrid(this.dataCanvas,this.context.width,this.context.height),this.renderData(this.context)),b=(new Date).getTime(),console.log("rendered chart in "+(b-a)+"ms")},c}()}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){var b,c,d;for(c=Math.log10(a),b=Math.pow(10,Math.ceil(c)-1),d=a/b;d>10;)b*=2,d=a/b;return Math.ceil(a/b)*b},this.StackedBarChart=function(a){function b(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;for(_.defaults(d,{xField:"x",yField:"y",groupField:"group",opacityField:null,xLabel:"x",yLabel:"y",yPrefix:"",title:"Title",title_class:null,useDataCanvas:!1,interact:!1,onClick:function(){return{}}}),b.__super__.constructor.call(this,a,d),this.container.addClass("stacked-bar"),"$"===this.opts.yPrefix&&(this.yFormatter=new DollarFormatter),u=_.pluck(c,d.xField),t=_.uniq(u),d.xOrder||(d.xOrder=t.sort()),h=100/d.xOrder.length,j=_.uniq(_.pluck(c,d.groupField)),d.groupOrder||(d.groupOrder=j.sort()),this.xAxis.setFixedArray(d.xOrder),w=0,s={},G=d.xOrder,y=0,C=G.length;C>y;y++)r=G[y],q=_.filter(c,function(a){return a[d.xField]===r}),n=_.reduce(q,function(a,b){return a+b[d.yField]},0),w=Math.max(w,n),s[r]={values:q,total:n};for(this.yResize(0,w),this.yRound(),w=this.yAxis.max,m=this,H=d.xOrder,z=0,D=H.length;D>z;z++){for(r=H[z],g=$("<div class='column' style='width: "+h+"%'></div>").appendTo(this.dataCanvasContainer),v=0,I=d.groupOrder,A=0,E=I.length;E>A;A++)for(i=I[A],f=d.groupColors[i],q=_.filter(s[r].values,function(a){return a[d.groupField]===i}),x=function(a){return e.click(function(){return m.dataCanvasContainer.find("a.box").removeClass("active"),$(this).addClass("active"),d.onClick(a)})},B=0,F=q.length;F>B;B++)p=q[B],k=p[d.yField]/w*100,l=1,d.opacityField&&(l=p[d.opacityField]),e=$("<a class='box' style='height: "+k+"%; bottom: "+v+"%; background-color: "+f+"; opacity: "+l+"'></a>").appendTo(g),x(p),v+=k;o=this.yFormatter.format(this.yAxis.span,s[r].total),$("<div class='total' style='bottom: "+v+"%'>"+d.yPrefix+o+"</div>").appendTo(g)}this.render()}return c(b,a),b}(Chart),window.tinyplot.StackedBarChart=StackedBarChart}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a,b){var c,d,e,f,g,h;if(e=0,c=a.length-1,h=a[e],f=a[c],h>=b)return 0;if(b>=f)return a.length-1;for(;c-e>1;)d=Math.round((e+c)/2),g=a[d],g>b?(c=d,f=g):(e=d,h=g);return b-h>f-b?c:e},this.TimeseriesChart=function(b){function d(a,b,c){var e,f,g,h,i,j,k,l,m,n,o,p;for(_.defaults(c,{timeField:"time",xLabel:"Time",xZoom:"user",yZoom:"auto",cursorColor:"#f00",series:[],xMaxTicks:6}),d.__super__.constructor.call(this,a,c),this.container.addClass("timeseries"),this.xFormatter=new TimeFormatter,this.xAxis.roundingStrategy="time",this.time=_.pluck(b,this.opts.timeField),g=this.time[0],f=this.time[this.time.length-1],this.xResize(g,f),this.xClamp(),j=null,i=null,this.data=b,p=this.opts.series,l=0,n=p.length;n>l;l++)for(e=p[l],k=_.pluck(b,e.yField),_.defaults(e,{color:"#000",width:1,markerSize:6}),m=0,o=k.length;o>m;m++)h=k[m],(!j||j>h)&&(j=h),(!i||h>i)&&(i=h);this.yResize(j,i),this.yRound(),this.cursor=$("<div class='cursor'><div class='bar' style='border-left: 1px solid "+c.cursorColor+"'></div><div class='info'></div></div>").appendTo(this.dataCanvasContainer),this.cursorWidth=this.cursor.width(),this.render()}return c(d,b),d.prototype.renderData=function(b){var c,d,e,f,g,h,i,j,k,l,m;for(d=a(this.time,b.xRange.min),d>0&&(d-=1),c=a(this.time,b.xRange.max),c<this.data.length-2&&(c+=1),f=this.data.slice(d,+c+1||9e9),g=_.pluck(f,this.opts.timeField),m=this.opts.series,k=0,l=m.length;l>k;k++)h=m[k],j=_.pluck(f,h.yField),b.setStroke(h.color,h.width),b.stroke(function(){var a,c,d,e;for(b.moveTo({x:g[0],y:j[0]}),e=[],a=c=1,d=f.length-1;d>=1?d>=c:c>=d;a=d>=1?++c:--c)e.push(b.lineTo({x:g[a],y:j[a]}));return e}),h.marker&&f.length<b.width/4&&b.drawMarkers(h.marker,h.markerSize,h.color,g,j);return this.cursor.is(":visible")?(i=parseFloat(this.cursor.data("time")),e={x:i,y:0},b.plotToCanvas(e),this.cursor.css("left",e.x-this.cursorWidth/2)):void 0},d.prototype.onClick=function(b){var c,d,e,f,g,h,i,j,k,l;for(this.context.canvasToPlot(b),c=a(this.time,b.x),i=this.data[c],h=i[this.opts.timeField],e={x:h,y:0},this.context.plotToCanvas(e),this.cursor.css("left",e.x-this.cursorWidth/2),this.cursor.data("time",h),d=this.cursor.find(".info"),d.html(""),g=this.xFormatter.format(this.xAxis.span,b.x).replace("|"," "),d.append("<div style='color: "+this.opts.cursorColor+"'>"+g+"</div>"),l=this.opts.series,j=0,k=l.length;k>j;j++)f=l[j],d.append("<div style='color: "+f.color+"'>"+f.yField+": "+i[f.yField]+"</div>");return this.cursor.show()},d}(Chart),window.tinyplot.TimeseriesChart=TimeseriesChart}.call(this);